<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body id="body">
    
</body>

<script type="text/javascript">


    let memory = new WebAssembly.Memory({initial: 10, maximum:20}); // page size (64kB)
    let table = new WebAssembly.Table({initial: 2, element:"anyfunc"});
    let stack_pointer = new WebAssembly.Global({value: "i32", mutable: true}, 1); // bytes


    const importObject = {
        env: {
            memory: memory,
            __memory_base: 0, // bytes or index?
            __table_base: 1024, // starting index
            __indirect_function_table: table,
            __stack_pointer: stack_pointer, // bytes

            // Import JS functions to C code

            // Basic function for printing strings from linear memory
            print: function(x) {
                console.log(x);
            },
            print_string: function(s, len) {
                let array = new Uint8Array(memory.buffer);
                res = "";
                for(let i=s; i < s + len; i++) {
                    res += array[i]
                }
                console.log(res);
            }
        },
    };


    WebAssembly.instantiateStreaming(fetch("clang.wasm"), importObject).then(obj => {
        obj.instance.exports.main();
        console.log("--- MEMORY ---")
        console.log(memory);
    });


    
</script>

</html>